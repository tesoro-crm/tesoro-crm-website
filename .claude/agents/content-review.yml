name: Tesoro CRM - Content Review

on:
  pull_request:
    types: [opened, synchronize, ready_for_review, reopened]
    paths:
      - 'src/content/**'
      - 'docs/**/*.md'
      - 'README.md'
      - 'src/pages/**/*.astro'
      - 'src/utils/authors.ts'

jobs:
  content-review:
    runs-on: ubuntu-latest
    if: github.event.pull_request.draft == false
    
    permissions:
      contents: read
      pull-requests: write
      issues: read
      id-token: write
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 2

      - name: Analyze content changes
        id: content-scope
        run: |
          changed_files=$(git diff --name-only HEAD^ HEAD)
          
          blog_content=false
          kb_content=false
          documentation=false
          page_content=false
          author_data=false
          
          if echo "$changed_files" | grep -E 'src/content/blog/' | wc -l | grep -q -v '^0$'; then
            blog_content=true
          fi
          
          if echo "$changed_files" | grep -E 'src/content/knowledge-base/' | wc -l | grep -q -v '^0$'; then
            kb_content=true
          fi
          
          if echo "$changed_files" | grep -E '\.md$' | wc -l | grep -q -v '^0$'; then
            documentation=true
          fi
          
          if echo "$changed_files" | grep -E 'src/pages/.*\.astro$' | wc -l | grep -q -v '^0$'; then
            page_content=true
          fi
          
          if echo "$changed_files" | grep -E 'src/utils/authors\.ts' | wc -l | grep -q -v '^0$'; then
            author_data=true
          fi
          
          echo "blog_content=$blog_content" >> $GITHUB_OUTPUT
          echo "kb_content=$kb_content" >> $GITHUB_OUTPUT
          echo "documentation=$documentation" >> $GITHUB_OUTPUT
          echo "page_content=$page_content" >> $GITHUB_OUTPUT
          echo "author_data=$author_data" >> $GITHUB_OUTPUT

      - name: Run Content Quality Review
        uses: anthropics/claude-code-action@v1
        with:
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          track_progress: true
          prompt: |
            REPO: ${{ github.repository }}
            PR NUMBER: ${{ github.event.pull_request.number }}
            
            ‚úçÔ∏è **TESORO CRM CONTENT REVIEW**
            
            You are reviewing content changes for Tesoro CRM, focusing on quality, brand compliance, and user value.
            
            **CONTENT SCOPE ANALYSIS:**
            - Blog Content: ${{ steps.content-scope.outputs.blog_content }}
            - Knowledge Base: ${{ steps.content-scope.outputs.kb_content }}
            - Documentation: ${{ steps.content-scope.outputs.documentation }}
            - Page Content: ${{ steps.content-scope.outputs.page_content }}
            - Author Data: ${{ steps.content-scope.outputs.author_data }}
            
            ## üéØ CONTENT REVIEW FOCUS
            
            ### 1. **Brand Voice & Messaging**
            Reference: `docs/product/brand-identity.md`
            
            **Tone of Voice:**
            - ‚úÖ Professional but accessible (no corporate jargon)
            - ‚úÖ Helpful advisor, not salesperson
            - ‚úÖ Human and approachable with empathy
            - ‚úÖ Technical accuracy without complexity
            
            **Key Messages Consistency:**
            - ‚úÖ "Don't wait for leads ‚Äî Tesoro searches and matches for you"
            - ‚úÖ "All your communication and deal process in one clear system"
            - ‚úÖ "Build relationships AND close deals ‚Äî Tesoro supports both"
            - ‚úÖ "Integrations with tools you already use (Gmail, Outlook)"
            
            **Language-Specific Adaptations:**
            - ‚úÖ **Dutch**: Direct, practical, focus on efficiency ("U" formal, "je" tutorials)
            - ‚úÖ **English**: Professional, benefit-focused, global perspective
            - ‚úÖ **Spanish**: Friendly, detailed explanations, passionate about solutions
            
            ### 2. **Product Information Accuracy**
            Reference: `docs/product/product-specs.md`
            
            **Pricing Accuracy:**
            - ‚úÖ ‚Ç¨99/month up to 10 users (excluding VAT)
            - ‚úÖ ‚Ç¨10/month per additional user beyond 10
            - ‚úÖ Custom development: ‚Ç¨1,000 - ‚Ç¨5,000 depending on scope
            - ‚úÖ No email hosting included (integrates with Gmail/Outlook)
            
            **Feature Descriptions:**
            - ‚úÖ Smart property-customer matching (2x per day)
            - ‚úÖ Customer portal with feedback loop
            - ‚úÖ Visual Kanban deal management
            - ‚úÖ Native email integration (Gmail/Outlook)
            - ‚úÖ Real estate-focused features (MLS, property management)
            
            **Target Audience:**
            - ‚úÖ Real estate agents and professionals
            - ‚úÖ Focus on active sales vs. passive lead management
            - ‚úÖ Spanish market primary, international expansion planned
            
            ### 3. **Content Structure & Quality**
            
            **Blog Posts** (if applicable):
            Reference: `docs/content/blog/ai-guidelines.md`
            - ‚úÖ Required sections: Hero, Introduction, Problem, Solution, Results, Takeaways, CTA
            - ‚úÖ Reading time: 5-12 minutes (1,500-3,500 words)
            - ‚úÖ SEO optimization: 50-60 char titles, 150-160 char descriptions
            - ‚úÖ Category colors and consistent taxonomy
            
            **Knowledge Base** (if applicable):
            Reference: `docs/content/knowledge-base/ai-instructions.md`
            - ‚úÖ English slugs for cross-language consistency
            - ‚úÖ Proper category assignment (getting-started, contacts, etc.)
            - ‚úÖ Difficulty level appropriate (beginner, intermediate, advanced)
            - ‚úÖ Step-by-step structure with screenshots
            
            **Documentation** (if applicable):
            - ‚úÖ Clear, actionable information
            - ‚úÖ Proper markdown formatting and hierarchy
            - ‚úÖ Internal linking and cross-references
            - ‚úÖ Up-to-date information aligned with current features
            
            ### 4. **Multilingual Implementation**
            
            **JSON Structure Validation:**
            - ‚úÖ All text fields have nl, en, es keys
            - ‚úÖ Translations complete and culturally appropriate
            - ‚úÖ Consistent terminology across languages
            - ‚úÖ Proper character encoding and special characters
            
            **Content Localization:**
            - ‚úÖ Cultural adaptation where needed
            - ‚úÖ Local examples and references
            - ‚úÖ Currency and date format consistency
            - ‚úÖ Market-specific information accuracy
            
            ### 5. **SEO & Discoverability**
            Reference: `docs/operations/seo.md`
            
            **Meta Information:**
            - ‚úÖ Title tags 50-60 characters with primary keywords
            - ‚úÖ Meta descriptions 150-160 characters with CTA
            - ‚úÖ Keywords naturally integrated in content
            - ‚úÖ Proper heading hierarchy (H1 ‚Üí H2 ‚Üí H3)
            
            **Content Optimization:**
            - ‚úÖ Primary keywords in first 200 words
            - ‚úÖ Internal linking to related content
            - ‚úÖ Image alt text descriptive and keyword-rich
            - ‚úÖ URL structure clean and descriptive
            
            ### 6. **User Experience & Value**
            
            **Content Value:**
            - ‚úÖ Solves real user problems
            - ‚úÖ Actionable information provided
            - ‚úÖ Clear next steps or CTAs
            - ‚úÖ Appropriate depth for target audience
            
            **Readability:**
            - ‚úÖ Clear, concise writing
            - ‚úÖ Logical flow and structure
            - ‚úÖ Proper use of headings and bullet points
            - ‚úÖ Examples and explanations where needed
            
            ### 7. **Technical Implementation**
            
            **Schema Compliance:**
            - ‚úÖ JSON structure matches Zod schema (src/content/config.ts)
            - ‚úÖ All required fields populated
            - ‚úÖ Proper data types and formats
            - ‚úÖ Valid image URLs and alt text
            
            **Content Assets:**
            - ‚úÖ Images optimized for web (WebP, proper sizing)
            - ‚úÖ Screenshots current and high quality
            - ‚úÖ Videos properly embedded and accessible
            - ‚úÖ External links working and appropriate
            
            ## üìù CONTENT QUALITY CHECKLIST
            
            ### Writing Quality
            - [ ] Clear, engaging, and valuable to target audience
            - [ ] Grammar and spelling error-free
            - [ ] Consistent voice and tone throughout
            - [ ] Appropriate length and depth
            - [ ] Logical flow and structure
            
            ### Brand Compliance
            - [ ] Messaging aligned with brand voice
            - [ ] Product information accurate and current
            - [ ] Visual style consistent with brand guidelines
            - [ ] Target audience properly addressed
            - [ ] Value proposition clearly communicated
            
            ### Technical Accuracy
            - [ ] All technical information correct
            - [ ] Code examples working and current
            - [ ] Screenshots and visuals up-to-date
            - [ ] Links and references functional
            - [ ] Accessibility considerations met
            
            ### SEO & Discoverability
            - [ ] Keywords naturally integrated
            - [ ] Meta information optimized
            - [ ] Internal linking strategic
            - [ ] Search intent addressed
            - [ ] Content structure SEO-friendly
            
            ## üåç MULTILINGUAL REVIEW
            
            **If multilingual content:**
            1. **Check translation completeness** - All language variants present
            2. **Verify cultural adaptation** - Content appropriate for each market
            3. **Validate terminology consistency** - Same terms used across languages
            4. **Test reading flow** - Natural language flow in each variant
            5. **Confirm technical accuracy** - Features and pricing consistent
            
            ## üí¨ FEEDBACK APPROACH
            
            **Structure your review:**
            - **Content Quality** - Writing, value, and user experience
            - **Brand Compliance** - Voice, messaging, and product accuracy
            - **Technical Implementation** - Schema, SEO, and accessibility
            - **Multilingual Quality** - Translation and localization (if applicable)
            
            **Be constructive:**
            - Highlight both strengths and areas for improvement
            - Provide specific suggestions with examples
            - Reference relevant guidelines and documentation
            - Consider the content's purpose and target audience
            
            ## ‚úÖ APPROVAL CRITERIA
            
            Approve when:
            ‚úÖ Content provides clear value to target audience
            ‚úÖ Brand voice and messaging consistent
            ‚úÖ Product information accurate and current
            ‚úÖ Technical implementation correct
            ‚úÖ SEO optimization appropriate
            ‚úÖ Multilingual requirements met (if applicable)
            ‚úÖ Quality meets Tesoro CRM standards
            
            **Use `gh pr comment` to post your content review when complete.**
          
          claude_args: '--model claude-sonnet-4-20250514 --allowed-tools "mcp__github_inline_comment__create_inline_comment,Bash(gh pr comment:*),Bash(gh pr diff:*),Bash(gh pr view:*),Read,Grep,Glob"'