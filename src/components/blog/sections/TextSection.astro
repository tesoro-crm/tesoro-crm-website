---
/**
 * Generic content section for blog posts
 * Handles: problem, solution, results, takeaways, or any generic content
 */
import type { Language } from '../../../types/blog';
import ImageWithFallback from '../ImageWithFallback.astro';

interface Props {
  section: any; // Generic section type
  lang: Language;
}

const { section, lang } = Astro.props;
const content = section.content?.[lang];
const title = section.title?.[lang];
const image = section.image;
const subsections = section.subsections;
---

<section class="mb-12" id={section.id}>
  {title && (
    <h2 class="font-[family-name:var(--font-decorative)] text-[1.75rem] font-bold text-gray-900 mb-6 leading-tight tracking-tight">
      {title}
    </h2>
  )}
  
  {content && (
    <div class="prose prose-lg max-w-none mb-8 text-gray-700 leading-relaxed" set:html={content.text} />
  )}
  
  {image && (
    <figure class="my-10">
      <ImageWithFallback
        src={image.src}
        alt={image.alt[lang]}
        width={image.width || 800}
        height={image.height || 450}
        loading="lazy"
        aspectRatio="16/9"
      />
      {image.caption && (
        <figcaption class="mt-3 text-sm text-gray-500 text-center italic">
          {image.caption[lang]}
        </figcaption>
      )}
    </figure>
  )}
  
  {subsections && subsections.length > 0 && (
    <div class="mt-8 space-y-12">
      {subsections.map((subsection: any) => {
        const subTitle = subsection.title[lang];
        const subContent = subsection.content[lang];
        const subImage = subsection.image;
        const code = subsection.code;
        
        return (
          <div class="subsection" id={subsection.id}>
            <h3 class="font-[family-name:var(--font-decorative)] text-2xl font-bold text-gray-900 mb-4 leading-tight tracking-tight">
              {subTitle}
            </h3>
            
            <div class="prose prose-lg max-w-none text-gray-700 leading-relaxed" set:html={subContent.text} />
            
            {subImage && (
              <figure class="my-8">
                <ImageWithFallback
                  src={subImage.src}
                  alt={subImage.alt[lang]}
                  width={subImage.width || 600}
                  height={subImage.height || 400}
                  loading="lazy"
                  aspectRatio="3/2"
                />
                {subImage.caption && (
                  <figcaption class="mt-3 text-sm text-gray-500 text-center italic">
                    {subImage.caption[lang]}
                  </figcaption>
                )}
              </figure>
            )}
            
            {code && (
              <figure class="my-8 bg-slate-900 rounded-lg overflow-hidden">
                <pre class="p-6 overflow-x-auto m-0"><code class={`language-${code.language} font-mono text-[0.95rem] leading-relaxed text-slate-50`}>{code.code}</code></pre>
                {code.caption && (
                  <figcaption class="px-6 pb-4 text-sm text-slate-400 italic">
                    {code.caption[lang]}
                  </figcaption>
                )}
              </figure>
            )}
          </div>
        );
      })}
    </div>
  )}
</section>

<style>
  .blog-section {
    margin-bottom: 3rem;
  }

  .blog-section__title {
    font-family: var(--font-decorative);
    font-size: 1.75rem;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 1.5rem;
    line-height: 1.3;
    letter-spacing: -0.01em;
    text-transform: none;
  }

  .blog-section__content {
    font-size: 1.125rem;
    line-height: 1.8;
    color: var(--text-secondary);
    margin-bottom: 2rem;
  }

  .blog-section__content :global(p) {
    margin-bottom: 1.5rem;
  }

  .blog-section__figure {
    margin: 2.5rem 0;
  }

  .blog-section__caption {
    margin-top: 0.75rem;
    font-size: 0.875rem;
    color: #64748b;
    text-align: center;
    font-style: italic;
  }

  .blog-section__subsections {
    margin-top: 2rem;
  }

  .subsection {
    margin-bottom: 3rem;
  }

  .subsection:last-child {
    margin-bottom: 0;
  }

  .subsection__title {
    font-family: var(--font-decorative);
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 1rem;
    line-height: 1.3;
    letter-spacing: -0.01em;
    text-transform: none;
  }

  .subsection__content {
    font-size: 1.125rem;
    line-height: 1.8;
    color: var(--text-secondary);
  }

  .subsection__content :global(p) {
    margin-bottom: 1.5rem;
  }

  .subsection__figure {
    margin: 2rem 0;
  }

  .subsection__caption {
    margin-top: 0.75rem;
    font-size: 0.875rem;
    color: #64748b;
    text-align: center;
    font-style: italic;
  }

  .subsection__code-block {
    margin: 2rem 0;
    background: #1e293b;
    border-radius: 8px;
    overflow: hidden;
  }

  .subsection__code-block pre {
    margin: 0;
    padding: 1.5rem;
    overflow-x: auto;
  }

  .subsection__code-block code {
    font-family: var(--font-mono);
    font-size: 0.95rem;
    line-height: 1.6;
    color: #f1f5f9;
  }
</style>
