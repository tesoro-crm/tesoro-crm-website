---
import { ViewTransitions } from 'astro:transitions';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import { getLocale, getAlternateLinks } from '../i18n/utils';
import type { Language } from '../i18n/config';

// Self-hosted fonts for better performance
import '@fontsource/inter/400.css';
import '@fontsource/inter/500.css';
import '@fontsource/inter/600.css';
import '@fontsource/inter/700.css';
import '@fontsource/poppins/600.css';
import '@fontsource/poppins/700.css';

export interface Props {
  title?: string;
  description?: string;
}

const locale: Language = getLocale(Astro.currentLocale, Astro.url);
const currentPath = Astro.url.pathname;
const alternateLinks = getAlternateLinks(currentPath);

// Get site URL from environment or use current origin
const siteUrl = import.meta.env.SITE || Astro.url.origin;

// Default meta tags per language
const defaultMeta = {
  es: {
    title: 'Tesoro CRM - Captación inteligente para profesionales inmobiliarios',
    description: 'Automatiza la captación de propiedades con IA y maximiza tu ROI inmobiliario',
  },
  en: {
    title: 'Tesoro CRM - Intelligent Lead Generation for Real Estate Professionals',
    description: 'Automate property lead generation with AI and maximize your real estate ROI',
  },
  nl: {
    title: 'Tesoro CRM - Intelligente Leadgeneratie voor Vastgoedprofessionals',
    description: 'Automatiseer vastgoed leadgeneratie met AI en maximaliseer je ROI',
  },
};

const {
  title = defaultMeta[locale].title,
  description = defaultMeta[locale].description,
} = Astro.props;
---

<!doctype html>
<html lang={locale}>
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content={description || defaultMeta[locale].description} />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>
		
		<!-- Canonical URL -->
		<link rel="canonical" href={`${siteUrl}${currentPath}`} />
		
		<!-- Open Graph -->
		<meta property="og:type" content="website" />
		<meta property="og:title" content={title} />
		<meta property="og:description" content={description} />
		<meta property="og:locale" content={locale === 'es' ? 'es_ES' : locale === 'en' ? 'en_US' : 'nl_NL'} />
		<meta property="og:url" content={`${siteUrl}${currentPath}`} />
		
		<!-- Hreflang Tags for SEO -->
		{alternateLinks.map(({ lang, href }) => (
			<link rel="alternate" hreflang={lang} href={`${siteUrl}${href}`} />
		))}
		<link rel="alternate" hreflang="x-default" href={`${siteUrl}/`} />
		
		<!-- Structured Data (JSON-LD) -->
		<script type="application/ld+json" set:html={
			JSON.stringify({
				"@context": "https://schema.org",
				"@graph": [
					{
						"@type": "Organization",
						"@id": `${siteUrl}#organization`,
						"name": "Tesoro CRM",
						"alternateName": "Tesoro",
						"description": locale === 'nl' 
							? "Intelligente leadgeneratie voor vastgoedprofessionals met AI-powered CRM"
							: locale === 'en'
							? "Intelligent lead generation for real estate professionals with AI-powered CRM"
							: "Captación inteligente para profesionales inmobiliarios con CRM impulsado por IA",
						"url": siteUrl,
						"logo": {
							"@type": "ImageObject",
							"url": `${siteUrl}/assets/tesoro-logo.svg`,
							"width": 200,
							"height": 60
						},
						"foundingDate": "2025",
						"sameAs": [
							"https://linkedin.com/company/tesoro-crm",
							"https://twitter.com/tesoro_crm"
						],
						"contactPoint": {
							"@type": "ContactPoint",
							"telephone": "+31-20-123-4567",
							"contactType": "customer service",
							"availableLanguage": ["Dutch", "English", "Spanish"],
							"areaServed": ["NL", "BE", "ES", "GB"]
						},
						"address": {
							"@type": "PostalAddress",
							"addressCountry": "NL",
							"addressLocality": "Amsterdam"
						}
					},
					{
						"@type": "WebSite",
						"@id": `${siteUrl}#website`,
						"url": siteUrl,
						"name": "Tesoro CRM",
						"description": locale === 'nl'
							? "Intelligente leadgeneratie voor vastgoedprofessionals"
							: locale === 'en'
							? "Intelligent lead generation for real estate professionals"
							: "Captación inteligente para profesionales inmobiliarios",
						"publisher": { "@id": `${siteUrl}#organization` },
						"inLanguage": locale,
						"potentialAction": {
							"@type": "SearchAction",
							"target": `${siteUrl}/search?q={search_term_string}`,
							"query-input": "required name=search_term_string"
						}
					},
					{
						"@type": "SoftwareApplication",
						"@id": `${siteUrl}#software`,
						"name": "Tesoro CRM",
						"description": locale === 'nl'
							? "AI-powered CRM voor vastgoed leadgeneratie met automatische matching"
							: locale === 'en'
							? "AI-powered CRM for real estate lead generation with automatic matching"
							: "CRM impulsado por IA para generación de leads inmobiliarios con matching automático",
						"url": siteUrl,
						"applicationCategory": "BusinessApplication",
						"operatingSystem": "Web Browser",
						"offers": {
							"@type": "Offer",
							"price": "99",
							"priceCurrency": "EUR",
							"description": locale === 'nl'
								? "Vanaf €99/maand voor individuele makelaars"
								: locale === 'en'
								? "From €99/month for individual agents"
								: "Desde €99/mes para agentes individuales",
							"seller": { "@id": `${siteUrl}#organization` }
						},
						"featureList": [
							"AI-powered lead generation",
							"MLS integration",
							"Automated compliance",
							"Real-time matching",
							"Customer portal",
							"Multi-language support"
						]
					},
					{
						"@type": "Service",
						"@id": `${siteUrl}#service`,
						"name": "AI-Powered Real Estate CRM",
						"description": locale === 'nl'
							? "Intelligente CRM oplossing voor vastgoedprofessionals met automatische lead matching"
							: locale === 'en'
							? "Intelligent CRM solution for real estate professionals with automatic lead matching"
							: "Solución CRM inteligente para profesionales inmobiliarios con matching automático de leads",
						"provider": { "@id": `${siteUrl}#organization` },
						"serviceType": "CRM Software",
						"areaServed": {
							"@type": "Country",
							"name": ["Netherlands", "Belgium", "Spain", "United Kingdom"]
						},
						"hasOfferCatalog": {
							"@type": "OfferCatalog",
							"name": "Tesoro CRM Pricing",
							"itemListElement": [
								{
									"@type": "Offer",
									"itemOffered": {
										"@type": "Service",
										"name": "Starter Plan",
										"description": "Perfect for individual agents"
									},
									"price": "99",
									"priceCurrency": "EUR",
									"priceSpecification": {
										"@type": "UnitPriceSpecification",
										"price": "99",
										"priceCurrency": "EUR",
										"referenceQuantity": {
											"@type": "QuantitativeValue",
											"value": "1",
											"unitText": "month"
										}
									}
								}
							]
						}
					}
				]
			})
		}></script>
		
		<!-- View Transitions -->
		<ViewTransitions />
	</head>
	<body class="font-sans text-neutral-800 antialiased overflow-x-hidden">
		<Header />
		<main class="overflow-x-hidden">
			<slot />
		</main>
		<Footer />
	</body>
</html>